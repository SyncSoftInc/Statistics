function addSources(){map.getSource("geoCollection")||map.addSource("geoCollection",{type:"geojson",data:geoCollection});selection.id!=="population"||map.getSource("population")||map.addSource("population",{type:"vector",url:"mapbox://mapbox.660ui7x6"})}function addLayers(){switch(selection.id){case"population":addPopLayer()}addAreaLayer()}function addPopLayer(){map.getLayer("state-population")||(map.addLayer({id:"state-population",source:"population","source-layer":"state_county_population_2014_cen",maxzoom:zoomThreshold,type:"fill",filter:["==","isState",!0],paint:{"fill-color":["interpolate",["linear"],["get","population"],0,"#F2F12D",5e5,"#EED322",75e4,"#E6B71E",1e6,"#DA9C20",25e5,"#CA8323",5e6,"#B86B25",75e5,"#A25626",1e7,"#8B4225",25e6,"#723122"],"fill-opacity":.75}},"waterway-label"),map.addLayer({id:"county-population",source:"population","source-layer":"state_county_population_2014_cen",minzoom:zoomThreshold,type:"fill",filter:["==","isCounty",!0],paint:{"fill-color":["interpolate",["linear"],["get","population"],0,"#F2F12D",100,"#EED322",1e3,"#E6B71E",5e3,"#DA9C20",1e4,"#CA8323",5e4,"#B86B25",1e5,"#A25626",5e5,"#8B4225",1e6,"#723122"],"fill-opacity":.75}},"waterway-label"))}function addAreaLayer(){geoCollection.features.forEach(function(n){var t=n.properties.id;map.getLayer(t)||(map.addLayer({id:t,type:"symbol",source:"geoCollection",layout:{"text-field":"{title}\n{statistics}","text-size":20},paint:{"text-color":"#202","text-halo-color":"#fff","text-halo-width":2},filter:["==","id",t]}),layerIDs.push(t))})}function refreshAreaLayers(){layerIDs.forEach(function(n){map.removeLayer(n)});map.removeSource("geoCollection");map.addSource("geoCollection",{type:"geojson",data:geoCollection});addAreaLayer()}function loadData(){$.blockUI({css:{padding:"15px 0","font-size":"20px"},message:"Loading ..."});$.get("api/v1/shipping?startDate=20190101&endDate=20190102",function(n){var t=JSON.parse(n);t.ResultData.areas.forEach(function(n){geoCollection.features.forEach(function(t){n.Code===t.properties.id&&(t.properties.statistics=n.statistics.join("\n"))})});refreshAreaLayers();$.unblockUI()})}var geoCollection={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[-120,46]},properties:{id:"north-west",title:"NORTH WEST",statistics:""}},{type:"Feature",geometry:{type:"Point",coordinates:[-117,39]},properties:{id:"south-west",title:"SOUTH WEST",statistics:""}},{type:"Feature",geometry:{type:"Point",coordinates:[-103,46]},properties:{id:"north-central",title:"NORTH CENTRAL",statistics:""}},{type:"Feature",geometry:{type:"Point",coordinates:[-100,36]},properties:{id:"south-central",title:"SOUTH CENTRAL",statistics:""}},{type:"Feature",geometry:{type:"Point",coordinates:[-87,43]},properties:{id:"great-lakes",title:"GREAT LAKES",statistics:""}},{type:"Feature",geometry:{type:"Point",coordinates:[-77,41]},properties:{id:"north-east",title:"NORTH EAST",statistics:""}},{type:"Feature",geometry:{type:"Point",coordinates:[-85,34]},properties:{id:"south-east",title:"SOUTH EAST",statistics:""}}]},zoom=4.3,zoomThreshold=zoom+.01,map,selection,layerIDs;mapboxgl.accessToken="pk.eyJ1IjoibHVraXlhIiwiYSI6ImNqdmN2dDFlOTFka3E0M25tNGxqdHduNTUifQ.tCI7E4cYwP_rxlmyX1sD8A";map=new mapboxgl.Map({container:"map",center:[-100,38],zoom:zoom});selection=document.getElementById("area");$("#switch input").click(function(){selection=this;map.setStyle("mapbox://styles/"+selection.value)});map.on("styledata",function(){addSources();addLayers()});layerIDs=[];$(function(){$("#area").click();loadData()});